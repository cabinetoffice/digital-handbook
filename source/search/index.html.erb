---
title: Search results
layout: custom
---

<section class="govuk-width-container">
  <h1 class="govuk-heading-l">Search results</h1>

  <div id="search-summary" class="govuk-body"></div>
  <div id="search-results" class="govuk-!-margin-top-4"></div>
</section>

<script>
(function () {
  // read ?q= from the URL
  function getParam(name) {
    var m = new RegExp('[?&]' + name + '=([^&]+)').exec(location.search);
    return m ? decodeURIComponent(m[1].replace(/\+/g, ' ')) : '';
  }

  var q = (getParam('q') || '').trim();
  var summary = document.getElementById('search-summary');
  var outlet  = document.getElementById('search-results');

  if (!q) {
    summary.textContent = 'Type a query in the search box and press Enter.';
    return;
  }
  summary.textContent = 'Results for "' + q + '"';

  // fetch the prebuilt index
  fetch('search.json')
    .then(function (r) { return r.json(); })
    .then(function (docs) {
      var ql = q.toLowerCase();
      var hits = [];

      // simple case-insensitive match over title + content
      for (var i = 0; i < docs.length; i++) {
        var d = docs[i];
        var t = (d.title || '').toLowerCase();
        var c = (d.content || '').toLowerCase();
        if (t.indexOf(ql) > -1 || c.indexOf(ql) > -1) hits.push(d);
      }

      if (hits.length === 0) {
        outlet.innerHTML = '<p class="govuk-body">No results found.</p>';
        return;
      }

      function escapeHtml(s) {
        return String(s).replace(/[&<>"']/g, function (m) {
          return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
        });
      }

      function snippet(text) {
        if (!text) return '';
        var t = String(text);
        var pos = t.toLowerCase().indexOf(ql);
        var start = Math.max(0, pos - 60);
        var end = Math.min(t.length, (pos > -1 ? pos + q.length + 60 : 160));
        var sn = t.slice(start, end);
        var re = new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'ig');
        sn = escapeHtml(sn).replace(re, function (m) { return '<mark>' + escapeHtml(m) + '</mark>'; });
        return (start > 0 ? '…' : '') + sn + (end < t.length ? '…' : '');
      }

      var html = '';
      for (var j = 0; j < hits.length; j++) {
        var h = hits[j];
        var url = h.url || '#';
        html += ''
          + '<div class="govuk-!-margin-bottom-6">'
          +   '<h2 class="govuk-heading-m govuk-!-margin-bottom-1"><a class="govuk-link" href="' + url + '">'
          +     escapeHtml(h.title || url)
          +   '</a></h2>'
          +   '<p class="govuk-body govuk-!-margin-bottom-1"><small>' + snippet(h.content) + '</small></p>'
          +   '<p class="govuk-body-s"><a class="govuk-link" href="' + url + '">' + escapeHtml(url) + '</a></p>'
          + '</div>';
      }
      outlet.innerHTML = html;
    })
    .catch(function (err) {
      outlet.innerHTML = '<p class="govuk-body">There was a problem loading search results.</p>';
      console.error(err);
    });
})();
</script>

